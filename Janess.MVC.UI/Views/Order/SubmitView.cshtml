@{
    ViewBag.Title = "结算";
    Layout = "~/Views/Shared/_Layout_Home.cshtml";
}
<style>
    #orderContent img {
        height: 80px;
        width: 80px;
    }

    #orderContent table {
        width: 100%;
    }
</style>
<input type="hidden" id="userName" value="@ViewBag.Name" />
<input type="hidden" id="userID" value="@ViewBag.BuyerID" />
<body>
    <div class="clear"></div>
    <div class="concent">
        <!--地址 -->
        <div class="paycont">
            @*<div class="address">
                <h3>确认收货地址 </h3>
                <div class="control">
                    <div class="tc-btn createAddr theme-login am-btn am-btn-danger">使用新地址</div>
                </div>
                <div class="clear"></div>
                <ul>
                    <div class="per-border"></div>
                    <li class="user-addresslist defaultAddr">

                        <div class="address-left">
                            <div class="user DefaultAddr">

                                <span class="buy-address-detail">
                                    <span class="buy-user">艾迪 </span>
                                    <span class="buy-phone">15871145629</span>
                                </span>
                            </div>
                            <div class="default-address DefaultAddr">
                                <span class="buy-line-title buy-line-title-type">收货地址：</span>
                                <span class="buy--address-detail">
                                    <span class="province">湖北</span>省
                                    <span class="city">武汉</span>市
                                    <span class="dist">洪山</span>区
                                    <span class="street">雄楚大道666号(中南财经政法大学)</span>
                                </span>

                                </span>
                            </div>
                            <ins class="deftip">默认地址</ins>
                        </div>
                        <div class="address-right">
                            <a href="../person/address.html">
                                <span class="am-icon-angle-right am-icon-lg"></span>
                            </a>
                        </div>
                        <div class="clear"></div>

                        <div class="new-addr-btn">
                            <a href="#" class="hidden">设为默认</a>
                            <span class="new-addr-bar hidden">|</span>
                            <a href="#">编辑</a>
                            <span class="new-addr-bar">|</span>
                            <a href="javascript:void(0);" onclick="delClick(this);">删除</a>
                        </div>

                    </li>
                    <div class="per-border"></div>
                    <li class="user-addresslist">
                        <div class="address-left">
                            <div class="user DefaultAddr">

                                <span class="buy-address-detail">
                                    <span class="buy-user">艾迪 </span>
                                    <span class="buy-phone">15871145629</span>
                                </span>
                            </div>
                            <div class="default-address DefaultAddr">
                                <span class="buy-line-title buy-line-title-type">收货地址：</span>
                                <span class="buy--address-detail">
                                    <span class="province">湖北</span>省
                                    <span class="city">武汉</span>市
                                    <span class="dist">武昌</span>区
                                    <span class="street">东湖路75号众环大厦2栋9层902</span>
                                </span>

                                </span>
                            </div>
                            <ins class="deftip hidden">默认地址</ins>
                        </div>
                        <div class="address-right">
                            <span class="am-icon-angle-right am-icon-lg"></span>
                        </div>
                        <div class="clear"></div>

                        <div class="new-addr-btn">
                            <a href="#">设为默认</a>
                            <span class="new-addr-bar">|</span>
                            <a href="#">编辑</a>
                            <span class="new-addr-bar">|</span>
                            <a href="javascript:void(0);" onclick="delClick(this);">删除</a>
                        </div>

                    </li>

                </ul>

                <div class="clear"></div>
            </div>*@

            <!--支付方式-->
            <div class="logistics">
                <h3>选择支付方式</h3>
                <ul class="pay-list">
                    <li class="pay card"><img src="~/Image/Order/wangyin.jpg" />银联<span></span></li>
                    <li class="pay qq"><img src="~/Image/Order/weizhifu.jpg" />>微信<span></span></li>
                    <li class="pay taobao"><img src="~/Image/Order/zhifubao.jpg" />>支付宝<span></span></li>
                </ul>
            </div>

            <!--订单 -->
            <div class="concent">
                <div id="payTable">
                    <h3>确认订单信息</h3>

                    <div id="orderContent">
                        <table class="table table-striped">
                            <tr>
                                <th>商品信息</th>
                                <th>单价</th>
                                <th>数量</th>
                                <th>金额</th>
                            </tr>

                        </table>
                    </div>
                </div>
                <div class="clear"></div>
                <div class="pay-total">
                    <!--留言-->
                    <div class="order-extra">
                        <div class="order-user-info">
                            <div id="holyshit257" class="memo">
                                <label>买家留言：</label>
                                <input type="text" title="选填,对本次交易的说明（建议填写已经和卖家达成一致的说明）" placeholder="选填,建议填写和卖家达成一致的说明" class="memo-input J_MakePoint c2c-text-default memo-close">
                                <div class="msg hidden J-msg">
                                    <p class="error">最多输入500个字符</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--含运费小计 -->
                <div class="buy-point-discharge ">
                    <p class="price g_price ">
                        合计（含运费） <span>¥</span><em class="pay-sum" id="allPrice"></em>
                    </p>
                </div>

                <!--信息 -->
                <div class="order-go clearfix">
                    <div class="pay-confirm clearfix">
                        @*<div class="box">
                                <div tabindex="0" id="holyshit267" class="realPay">
                                    <em class="t">实付款：</em>
                                    <span class="price g_price ">
                                        <span>¥</span> <em class="style-large-bold-red " id="J_ActualFee">244.00</em>
                                    </span>
                                </div>

                                <div id="holyshit268" class="pay-address">

                                    <p class="buy-footer-address">
                                        <span class="buy-line-title buy-line-title-type">寄送至：</span>
                                        <span class="buy--address-detail">
                                            <span class="province">湖北</span>省
                                            <span class="city">武汉</span>市
                                            <span class="dist">洪山</span>区
                                            <span class="street">雄楚大道666号(中南财经政法大学)</span>
                                        </span>
                                        </span>
                                    </p>
                                    <p class="buy-footer-address">
                                        <span class="buy-line-title">收货人：</span>
                                        <span class="buy-address-detail">
                                            <span class="buy-user">艾迪 </span>
                                            <span class="buy-phone">15871145629</span>
                                        </span>
                                    </p>
                                </div>
                            </div>*@

                        <div id="holyshit269" class="submitOrder">
                            <div class="go-btn-wrap">
                                <a id="J_Go" href="#" class="btn-go" tabindex="0" title="点击此按钮，提交订单">提交订单</a>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>
            </div>

            <div class="clear"></div>
        </div>
        <div class="theme-popover-mask"></div>
        <div class="theme-popover">

            <!--标题 -->
            @*<div class="am-cf am-padding">
                <div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">新增地址</strong> / <small>Add address</small></div>
            </div>*@
            <hr />

            @*<div class="am-u-md-12">
                <form class="am-form am-form-horizontal">

                    <div class="am-form-group">
                        <label for="user-name" class="am-form-label">收货人</label>
                        <div class="am-form-content">
                            <input type="text" id="user-name" placeholder="收货人">
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label for="user-phone" class="am-form-label">手机号码</label>
                        <div class="am-form-content">
                            <input id="user-phone" placeholder="手机号必填" type="email">
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label for="user-phone" class="am-form-label">所在地</label>
                        <div class="am-form-content address">
                            <select data-am-selected>
                                <option value="a">浙江省</option>
                                <option value="b">湖北省</option>
                            </select>
                            <select data-am-selected>
                                <option value="a">温州市</option>
                                <option value="b">武汉市</option>
                            </select>
                            <select data-am-selected>
                                <option value="a">瑞安区</option>
                                <option value="b">洪山区</option>
                            </select>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label for="user-intro" class="am-form-label">详细地址</label>
                        <div class="am-form-content">
                            <textarea class="" rows="3" id="user-intro" placeholder="输入详细地址"></textarea>
                            <small>100字以内写出你的详细地址...</small>
                        </div>
                    </div>

                    <div class="am-form-group theme-poptit">
                        <div class="am-u-sm-9 am-u-sm-push-3">
                            <div class="am-btn am-btn-danger">保存</div>
                            <div class="am-btn am-btn-danger close">取消</div>
                        </div>
                    </div>
                </form>
            </div>*@

        </div>

        <div class="clear"></div>
</body>
<input type="hidden" id="userID" value="@ViewBag.BuyerID" />
<input type="hidden" id="orderID" value="@ViewBag.OrderID" />
@section myScript{
    <script type="text/javascript">
        $("#J_Go").on("click", submitOrder);
        function submitOrder() {
            $.post("/Order/SubmitOrder", {

                orderID: $("#orderID").val()
            }, function (data) {
                if (data) {
                    alert("订单提交成功");
                    //清除购物车中订单数据
                    $.post("/Order/ClearOrder",
                        {
                            userID: $("#userID").val(),
                },function(){ });
                    alert("返回主页");
                    window.location.href = "/Home/Index";
                } else {
                    alert("失败");
                }
            });
        }
        var sum = 0;
        $(function () {
            hideen();
            getOrder();

        })
        function hideen() {
            if ($("#userName").val()) {
                $("#loginContainer").hide();
                $("#loginContainer1").show();
                $("#Name").hide();
                $("#Name1").show();
                $("#loginDiv").hide();
                $("#infoDiv").show();
                $.post("/Login/CheckSellerName", { Seller_Name: $("#hidName").val() },
                function (data) {
                    if (data) {
                        $("#shopDiv").show();
                    } else {
                        $("#shopDiv").hide();
                    }
                });
            } else {
                $("#loginContainer").show();
                $("#loginContainer1").hide();
                $("#Name").show();
                $("#Name1").hide();
                $("#message").hide();
                $("#wrap").hide();
            }
        }

        function getOrder() {
            $.post("/Order/GetOrderInfoByUserID",
                    {
                        orderID: $("#orderID").val()
                    },
                    function (data) {
                        var arr = $.getObjFromData(data);
                        for (var i = 0; i < arr.length; i++) {
                            var html = "";
                            html += "<tr>";
                            html += "<td><img src=" + arr[i].GOODS_IMAGE_URL + " />" + arr[i].GOODS_NAME + "</td>";
                            html += "<td>" + arr[i].GOODS_PRICE + "</td>";
                            html += "<td>" + arr[i].DETORSER_GOODS_NUM + "</td>";
                            html += "<td>" + arr[i].GOODS_PRICE * arr[i].DETORSER_GOODS_NUM + "</td>";
                            html += "</tr>";
                            $("#orderContent table").append(html);
                            sum += arr[i].GOODS_PRICE * arr[i].DETORSER_GOODS_NUM;
                        }
                        $("#allPrice").text(sum);
                    });


        }
    </script>
}