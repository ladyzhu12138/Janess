@{
    ViewBag.Title = "IntroductionView";
    Layout = "~/Views/Shared/_Layout_Search.cshtml";
}

<input type="hidden" id="userID" value="@ViewBag.BuyerID" />
<div class="clear"></div>
<b class="line"></b>
<div class="listMain">
    <ol class="am-breadcrumb am-breadcrumb-slash">
        <li><a href="#">首页</a></li>
        <li><a href="#">分类</a></li>
        <li class="am-active">内容</li>
    </ol>

    <!--放大镜-->

    <div class="item-inform">
        <div class="clearfixLeft" id="clearcontent">
            <div class="box">
                <div class="tb-booth tb-pic tb-s310" id="bigImage">
                    @*图片地址 动态添加 *@
                </div>

            </div>

            <div class="clear"></div>
        </div>

        <div class="clearfixRight">

            <!--规格属性-->
            <!--名称-->
            <div class="tb-detail-hd">
                @* 商品名称 动态添加*@
                <h1 id="goodsName"></h1>
            </div>
            <div class="tb-detail-list">
                <!--价格-->
                <div class="tb-detail-price">
                    <li class="price iteminfo_price">
                        <dt>价格</dt>
                        @* 动态添加价格 *@
                        <dd><em>¥</em><b class="sys_item_price" id="price"></b></dd>
                    </li>

                    <div class="clear"></div>
                </div>
                <div class="clear"></div>

                <!--各种规格-->
                <dl class="iteminfo_parameter sys_item_specpara">
                    <dt class="theme-login"><div class="cart-title">可选规格<span class="am-icon-angle-right"></span></div></dt>
                    <dd>
                        <!--操作页面-->

                        <div class="theme-popover-mask"></div>

                        <div class="theme-popover">
                            <div class="theme-span"></div>
                            <div class="theme-poptit">
                                <a href="javascript:;" title="关闭" class="close">×</a>
                            </div>
                            <div class="theme-popbod dform">
                                <form class="theme-signin" name="loginform" action="" method="post">

                                    <div class="theme-signin-left">

                                        <div class="theme-options">
                                            <div class="cart-title number">数量</div>
                    <dd>
                        <input id="min" class="am-btn am-btn-default" name="" type="button" value="-" />
                        <input id="text_box" name="" type="text" value="1" style="width:30px;" />
                        <input id="add" class="am-btn am-btn-default" name="" type="button" value="+" />
                        @* 库存 *@
                        <span id="Stock" class="tb-hidden">库存<span class="stock" id="kuCun"></span>件</span>
                    </dd>
            </div>
            <div class="clear"></div>
        </div>
        </form>
    </div>

</div>

    </dd>
    </dl>


    </div>

@* 全部加入js文件 *@
<div class="pay">
    <li>
        <div class="clearfix tb-btn tb-btn-buy theme-login">
            <a id="LikBuy" title="点此按钮到下一步确认购买信息">立即购买</a>
        </div>
    </li>
    <li>
        <div class="clearfix tb-btn tb-btn-basket theme-login">
            <a id="LikBasket" title="加入购物车"><i></i>加入购物车</a>
        </div>
    </li>
    <div class="clear"></div>
    <div style="width:500px; height:250px;">
        <div style="float:left; margin-top:100px;">
            <div class="clearfix tb-btn  theme-login" style="float:left;margin-right:10px">
                <a id="LikeGoods" title="收藏商品"><i></i>收藏商品</a>
            </div>
        </div>
        <div style="float:right">
            <h1 id="shopName">店铺名称</h1>
            <div class="clearfix tb-btn  theme-login" style="float:left;margin-right:10px">
                <a id="InShop" title="进入店铺" href="#"><i></i>进入店铺</a>
            </div>
            <div class="clearfix tb-btn  theme-login" style="float:right;">
                <a id="LikeShop" title="收藏店铺" href="#"><i></i>收藏店铺</a>
            </div>
            </>
        </div>
    </div>

</div>

<div class="clear"></div>

    </div>

<div class="clear"></div>


<!-- introduce-->

<div class="introduce">
    <div class="browse">
        <div class="mc">
            <ul>
                <div class="mt">
                    <h2>看了又看</h2>
                </div>

                <li class="first">
                    <div class="p-img">
                        <a href="#"> <img class="" src="../images/browse1.jpg"> </a>
                    </div>
                    <div class="p-name">
                        <a href="#">
                            【三只松鼠_开口松子】零食坚果特产炒货东北红松子原味
                        </a>
                    </div>
                    <div class="p-price"><strong>￥35.90</strong></div>
                </li>

            </ul>
        </div>
    </div>
    <div class="introduceMain">
        <div class="am-tabs" data-am-tabs>
            <ul class="am-avg-sm-3 am-tabs-nav am-nav am-nav-tabs">
                <li class="am-active">
                    <a href="#">

                        <span class="index-needs-dt-txt">宝贝详情</span>
                    </a>

                </li>

                <li>
                    <a href="#">

                        <span class="index-needs-dt-txt">全部评价</span>
                    </a>

                </li>

                <li>
                    <a href="#">

                        <span class="index-needs-dt-txt">猜你喜欢</span>
                    </a>
                </li>
            </ul>

            <div class="am-tabs-bd">

                <div class="am-tab-panel am-fade am-in am-active">
                    <div class="J_Brand">

                        <div class="attr-list-hd tm-clear">
                            <h4 id="goodsDescribe">产品参数：</h4>

                        </div>
                        <div class="clear"></div>

                        <div class="clear"></div>
                    </div>


                </div>

                <div class="am-tab-panel am-fade">
                    <div class="clear"></div>
                    <div class="tb-r-filter-bar">
                        <ul class=" tb-taglist am-avg-sm-4">
                            <li class="tb-taglist-li tb-taglist-li-current">
                                <div class="comment-info">
                                    <span>全部评价</span>
                                    <span class="tb-tbcr-num">(32)</span>
                                </div>
                            </li>

                            <li class="tb-taglist-li tb-taglist-li-1">
                                <div class="comment-info">
                                    <span>好评</span>
                                    <span class="tb-tbcr-num">(32)</span>
                                </div>
                            </li>

                            <li class="tb-taglist-li tb-taglist-li-0">
                                <div class="comment-info">
                                    <span>中评</span>
                                    <span class="tb-tbcr-num">(32)</span>
                                </div>
                            </li>

                            <li class="tb-taglist-li tb-taglist-li--1">
                                <div class="comment-info">
                                    <span>差评</span>
                                    <span class="tb-tbcr-num">(32)</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="clear"></div>
                    @* 动态添加评论 *@
                    <ul class="am-comments-list am-comments-list-flip" id="evaluate"></ul>

                    <div class="clear"></div>

                    <!--分页 -->
                    <ul class="am-pagination am-pagination-right">
                        <li class="am-disabled"><a href="#">&laquo;</a></li>
                        <li class="am-active"><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">5</a></li>
                        <li><a href="#">&raquo;</a></li>
                    </ul>
                    <div class="clear"></div>

                    <div class="tb-reviewsft">
                        <div class="tb-rate-alert type-attention">购买前请查看该商品的 <a href="#" target="_blank">购物保障</a>，明确您的售后保障权益。</div>
                    </div>

                </div>


            </div>

        </div>

        <div class="clear"></div>


    </div>

</div>
    </div>
<input type="hidden" id="goodsId" value="@ViewBag.GoodsId" />
<input type="hidden" id="hidName" value="@ViewBag.Name" />
@section myScript{
    <script>
        $(function () {
            $("#thumblist li a").click(function () {
                $(this).parents("li").addClass("tb-selected").siblings().removeClass("tb-selected");
                $(".jqzoom").attr('src', $(this).find("img").attr("mid"));
                $(".jqzoom").attr('rel', $(this).find("img").attr("big"));
            });
            $('.flexslider').flexslider({
                animation: "slide",
                start: function (slider) {
                    $('body').removeClass('loading');
                }
            });
            getGoodsInfo();
            getEvaluate();
            $("#LikBasket").on("click",addToCart);
            $("#LikeGoods").on("click", addToLikeGoods);
            $("#LikeShop").on("click", addToLikeShop);
            $("#LikBuy").on("click", addToOrder);
            if ($("#hidName").val()) {
                $("#loginContainer").hide();
                $("#loginContainer1").show();
            }
            else {
                $("#loginContainer").show();
                $("#loginContainer1").hide();
            }
        });
        function getGoodsInfo() {
            var goodsId = $("#goodsId").val();
            //alert(goodsId);
            $.post("/Buyer/getGoods", { GoodsID: goodsId }, function (data) {
                var arr = data[0];
                var GoodsName = arr.GOODS_NAME;
                var GoodsPrice = arr.GOODS_PRICE;
                var GoodsDescribe = arr.GOODS_DESCRIBE;
                var ShopID = arr.GOODS_SHOP_ID;
                var GoodsImg = arr.GOODS_IMAGE_URL;
                var ShopName = arr.SHOP_NAME;
                var GoodsRepertory = arr.GOODS_REPERTORY;
                var html = "<a href=" + GoodsImg + "><img src=" + GoodsImg + " alt='细节展示放大镜特效' rel=" + GoodsImg + " class='jqzoom' /></a>";
                $("#bigImage").html(html);//add goodsImsge
                $(".jqzoom").imagezoom();//this function is make imgae become big, need behind the image
                $("#goodsName").html(GoodsName);//add goodName
                $("#price").html(GoodsPrice);//add goodsPrice
                $("#kuCun").html(GoodsRepertory);
                $("#goodsDescribe").append(GoodsDescribe);
                var html2 = '<input type="hidden" id="shopId" value='+ShopID+'>';
                $("#shopName").html(ShopName);
                $("#shopName").append(html2);
            })
        };
        function getEvaluate() {
            var goodsId = $("#goodsId").val();
            $.post("/Buyer/getEvaluate", { GoodsID: goodsId }, function (data) {
                var arr = data;
                var html = "";
                for (var i = 0; i < arr.length; i++) {
                    var buyerName = arr[i].BUYER_NAME;
                    var buyerImage = arr[i].BUYER_IMAGE_URL;
                    var evaluateContent = arr[i].EVALUATE_CONTENT;
                    var evaluateStar = arr[i].EVALUATE_STAR;
                    var myDate = new Date();
                    var mytime = myDate.toLocaleString();
                    html += "<li class='am-comment'>";
                    html += "<a href=''>";
                    html += "<img class='am-comment-avatar' src=" + buyerImage + " />";
                    html += "</a>";
                    html += "<div class='am-comment-main'>";
                    html += "<header class='am-comment-hd'>";
                    html += "<div class='am-comment-meta'>";
                    html += "<a href='#link-to-user' class='am-comment-author'>" + buyerName + "</a>";
                    html += "评论于";
                    html += "<time datetime=''>" + mytime + "</time>";
                    html += "</div>";
                    html += "</header>";
                    html += "<div class='am-comment-bd'>";
                    html += "<div class='tb-rev-item ' data-id='255776406962'>";
                    html += "<div class='J_TbcRate_ReviewContent tb-tbcr-content '>";
                    html += evaluateContent;
                    html += "</div>";
                    html += "</div>";
                    html += "</div>";
                    html += "</div>";
                    html += "</li>";
                }
                $("#evaluate").html(html);

            });
        };

        function addToCart() {
            var url = "/Buyer/AddToCart";
            var goodsId = $("#goodsId").val();
            var shopId = $("#shopId").val();
            var goodsNum = $("#text_box").val();
            var userID = $("#userID").val();
            $.post(url, {
                GoodsID: goodsId,
                ShopID: shopId,
                GoodsNum: goodsNum,
                UserID: userID,
            }, function (data) {
                //将侧导航栏数据+1
                var num = $("#cart_num").text();
                num++;
                $("#cart_num").text(num);
                $("#J_MiniCartNum").text(num);
                alert("添加成功");
            });
        };
        function addToOrder() {
            var myDate = new Date();
            var orderID = myDate.getFullYear().toString();
            orderID += myDate.getMinutes();
            orderID += myDate.getSeconds();
            var goodsID = $("#goodsId").val();
            var shopId = $("#shopId").val();
            var num = $("#text_box").val();
            var userID = $("#userID").val();
            var price = $("#price").text() * num;
            $.post("/Buyer/AddToOrderDetail", { OrderID: orderID, GoodsID: goodsID, GoodsNumber: num }, function () { });
          
            $.post("/Buyer/AddToOrder", {
                UserID: userID,
                ShopID: shopId,
                OrderID: orderID,
                Price: price,
                OrderState: "未付款",
            }, function () {

                window.location.href = "/Order/SubmitView?orderID=" + orderID;
            })
        }
        function addToLikeGoods() {
            var goodsId = $("#goodsId").val();
            var url = "/Buyer/AddToCollect";
            var userID = $("#userID").val();
            $.post(url, {
                UserID: userID,
                CollectID: goodsId,
                Type: "商品",
            }, function (data) {
                //删除购物车内改商品
                // deleteGoods(evt);
                alert("收藏商品成功");
            });
        };

        function addToLikeShop() {
            var shopId = $("#shopId").val();
            var url = "/Buyer/AddToCollect";
            var userID = $("#userID").val();
            $.post(url, {
                UserID: userID,
                CollectID: shopId,
                Type: "店铺",
            }, function (data) {
                //删除购物车内改商品
                // deleteGoods(evt);
                alert("收藏店铺成功");
            });
        };
        $("#InShop").on("click", intorduction);
        function intorduction(evt) {
            var input = $("#shopId").val()
            var url = "/Buyer/IntroductionShopView?val=" + input;
            window.location.href = url;
        };
    </script>
}